# Cloudflare Pages éƒ¨ç½²å¤±è´¥è¯Šæ–­æŠ¥å‘Š

## é—®é¢˜åˆ†æ

æ ¹æ®æ‚¨æä¾›çš„æˆªå›¾ï¼Œéƒ¨ç½²å¤±è´¥å¯èƒ½ç”±ä»¥ä¸‹åŸå› å¯¼è‡´ï¼š

### 1. npm audit è­¦å‘Š
æ—¥å¿—æ˜¾ç¤ºï¼š
```
npm audit fix
Run 'npm audit' for details
```

è¿™é€šå¸¸æ˜¯ä¾èµ–åŒ…å­˜åœ¨å®‰å…¨æ¼æ´è­¦å‘Šï¼Œè™½ç„¶ä¸ä¸€å®šå¯¼è‡´æ„å»ºå¤±è´¥ï¼Œä½†åœ¨æŸäº›CI/CDç¯å¢ƒä¸­å¯èƒ½è¢«é…ç½®ä¸ºé˜»æ–­ã€‚

### 2. å¯èƒ½çš„ä¾èµ–å†²çª
é¡¹ç›®ä½¿ç”¨äº†è¾ƒæ–°çš„ä¾èµ–åŒ…ï¼Œå¯èƒ½å­˜åœ¨peer dependencyå†²çªã€‚

## è§£å†³æ–¹æ¡ˆ

æˆ‘å·²ç»ä¸ºæ‚¨åšäº†ä»¥ä¸‹ä¿®å¤ï¼š

### âœ… 1. æ·»åŠ äº†Node.jsç‰ˆæœ¬æŒ‡å®šæ–‡ä»¶
- `.node-version` - æŒ‡å®šä½¿ç”¨Node.js 18
- `.nvmrc` - å¤‡ç”¨ç‰ˆæœ¬æŒ‡å®šæ–‡ä»¶

### âœ… 2. æ›´æ–°äº†package.json
æ·»åŠ äº†æ–°çš„æ„å»ºå‘½ä»¤ï¼š
```json
"pages:build": "npm install --legacy-peer-deps && vite build"
```

ä½¿ç”¨ `--legacy-peer-deps` æ ‡å¿—å¯ä»¥é¿å…peer dependencyå†²çªã€‚

### âœ… 3. åˆ›å»ºäº†Cloudflare Pagesé…ç½®æ–‡ä»¶
- `pages.json` - æŒ‡å®šæ„å»ºé…ç½®å’Œç¯å¢ƒå˜é‡

### âœ… 4. åˆ›å»ºäº†GitHub Actionsè‡ªåŠ¨éƒ¨ç½²å·¥ä½œæµ
- `.github/workflows/cloudflare-pages.yml` - è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

### âœ… 5. åˆ›å»ºäº†éƒ¨ç½²æŒ‡å—
- `CLOUDFLARE_DEPLOYMENT.md` - è¯¦ç»†çš„éƒ¨ç½²è¯´æ˜

## ç«‹å³è¡ŒåŠ¨æ­¥éª¤

### æ–¹æ¡ˆA: åœ¨Cloudflare Pagesæ§åˆ¶å°é‡æ–°é…ç½®

1. **ç™»å½•Cloudflare Pagesæ§åˆ¶å°**
2. **è¿›å…¥é¡¹ç›®è®¾ç½®** (nodecrypt3)
3. **ä¿®æ”¹æ„å»ºè®¾ç½®**ï¼š
   - æ„å»ºå‘½ä»¤: `npm run pages:build`
   - æ„å»ºè¾“å‡ºç›®å½•: `dist`
   - Node.js ç‰ˆæœ¬: 18
4. **ä¿å­˜å¹¶é‡æ–°éƒ¨ç½²**

### æ–¹æ¡ˆB: ä½¿ç”¨GitHubæ¨é€åè‡ªåŠ¨éƒ¨ç½²

1. **å°†ä¿®æ”¹æ¨é€åˆ°GitHub**:
   ```bash
   git add .
   git commit -m "fix: ä¿®å¤Cloudflare Pageséƒ¨ç½²é…ç½®"
   git push origin main
   ```

2. **GitHub Actionsä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²**
   ï¼ˆéœ€è¦å…ˆé…ç½®Cloudflare APIå¯†é’¥ï¼‰

### æ–¹æ¡ˆC: ä½¿ç”¨Wrangler CLIæœ¬åœ°éƒ¨ç½² (æ¨è)

è¿™ä¸ªé¡¹ç›®å®é™…ä¸Šæ˜¯ä¸€ä¸ªCloudflare Workeré¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨Wrangleréƒ¨ç½²ï¼š

```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»ºå‰ç«¯
npm run build

# éƒ¨ç½²åˆ°Cloudflare (åŒ…å«Workerå’Œé™æ€èµ„æº)
npx wrangler deploy
```

## é‡è¦è¯´æ˜

### âš ï¸ é¡¹ç›®æ¶æ„ç‰¹æ®Šæ€§

æ‚¨çš„é¡¹ç›®ä¸æ˜¯çº¯é™æ€ç½‘ç«™ï¼Œè€Œæ˜¯ï¼š
- **Cloudflare Worker** + **Durable Objects** + **é™æ€èµ„æº**

è¿™æ„å‘³ç€ï¼š

1. **ä¸èƒ½ä»…ä½¿ç”¨Cloudflare Pageséƒ¨ç½²**
   - Pagesåªèƒ½éƒ¨ç½²é™æ€ç½‘ç«™
   - æ‚¨çš„é¡¹ç›®åŒ…å«æœåŠ¡ç«¯é€»è¾‘ï¼ˆWorkerï¼‰

2. **æ­£ç¡®çš„éƒ¨ç½²æ–¹å¼**:
   - ä½¿ç”¨ `wrangler deploy` å‘½ä»¤
   - è¿™ä¼šåŒæ—¶éƒ¨ç½²Workerå’Œé™æ€èµ„æº

3. **éœ€è¦Cloudflareä»˜è´¹è®¡åˆ’**
   - Durable Objectséœ€è¦ä»˜è´¹è®¡åˆ’
   - å…è´¹è®¡åˆ’æ— æ³•ä½¿ç”¨

## æ¨èçš„éƒ¨ç½²æµç¨‹

### å®Œæ•´éƒ¨ç½²æ­¥éª¤ï¼š

```bash
# 1. ç™»å½•Cloudflare
npx wrangler login

# 2. æ„å»ºå‰ç«¯èµ„æº
npm run build

# 3. éƒ¨ç½²æ•´ä¸ªåº”ç”¨ï¼ˆWorker + é™æ€èµ„æºï¼‰
npx wrangler deploy

# 4. æŸ¥çœ‹éƒ¨ç½²çš„URL
# Wranglerä¼šåœ¨éƒ¨ç½²æˆåŠŸåæ˜¾ç¤ºURL
```

### å¦‚æœåªæƒ³æµ‹è¯•å‰ç«¯ï¼š

```bash
# 1. æ„å»º
npm run build

# 2. æœ¬åœ°é¢„è§ˆdistæ–‡ä»¶å¤¹
npx serve dist
```

## æ£€æŸ¥æ¸…å•

åœ¨é‡æ–°éƒ¨ç½²å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] å·²å°†ä¿®æ”¹æäº¤åˆ°GitHub
- [ ] Cloudflareè´¦æˆ·æœ‰è¶³å¤Ÿçš„é…é¢
- [ ] å¦‚æœä½¿ç”¨Pagesï¼Œæ„å»ºå‘½ä»¤å·²æ”¹ä¸º `npm run pages:build`
- [ ] å¦‚æœä½¿ç”¨Wranglerï¼Œå·²è¿è¡Œ `wrangler login`
- [ ] å·²è¿è¡Œæœ¬åœ°æ„å»ºæµ‹è¯• `npm run build`

## åç»­å»ºè®®

1. **ä½¿ç”¨Wrangleréƒ¨ç½²** (å¼ºçƒˆæ¨è)
   - è¿™æ˜¯å®˜æ–¹æ¨èçš„Workeréƒ¨ç½²æ–¹å¼
   - æ”¯æŒDurable Objects
   - é…ç½®æ›´ç®€å•

2. **è®¾ç½®GitHub Actionsè‡ªåŠ¨éƒ¨ç½²**
   - éœ€è¦é…ç½®CLOUDFLARE_API_TOKEN
   - æ¯æ¬¡pushè‡ªåŠ¨éƒ¨ç½²

3. **åˆ†ç¦»å‰åç«¯** (å¯é€‰)
   - å¦‚æœåªæƒ³éƒ¨ç½²é™æ€é¡µé¢ï¼Œå¯ä»¥è€ƒè™‘åˆ†ç¦»å‰åç«¯
   - å‰ç«¯ç”¨Pagesï¼Œåç«¯ç”¨Worker

## å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: "Could not find Durable Object"
**åŸå› **: Durable Objectsæœªæ­£ç¡®é…ç½®æˆ–è´¦æˆ·æœªå‡çº§
**è§£å†³**: å‡çº§åˆ°Workersä»˜è´¹è®¡åˆ’

### é”™è¯¯2: "npm install failed"
**åŸå› **: peer dependencyå†²çª
**è§£å†³**: ä½¿ç”¨ `npm install --legacy-peer-deps`

### é”™è¯¯3: "Build timeout"
**åŸå› **: æ„å»ºæ—¶é—´è¿‡é•¿
**è§£å†³**: 
- å‡å°‘ä¾èµ–
- ä½¿ç”¨ `npm ci` ä»£æ›¿ `npm install`
- å¢åŠ æ„å»ºè¶…æ—¶æ—¶é—´

## è”ç³»æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·ï¼š
1. æ£€æŸ¥Cloudflare Pagesçš„æ„å»ºæ—¥å¿—
2. æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
3. å°è¯•æœ¬åœ°æ„å»º `npm run build` çœ‹æ˜¯å¦æˆåŠŸ

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ ğŸš€
